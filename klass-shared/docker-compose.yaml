services:
  mariadb:
    image: mariadb:11.7
    container_name: klass_mariadb
    ports:
      - "3306:3306"
    environment:
      MARIADB_ROOT_PASSWORD: ${MARIADB_ROOT_PASSWORD}
      MARIADB_USER: "klass"
      MARIADB_PASSWORD: ${MARIADB_LOCAL_PASSWORD}
      MARIADB_LOCAL_FILEPATH: ${MARIADB_LOCAL_FILEPATH}
      MARIADB_DATABASE: "klass"
  postgresql:
    image: postgres:17.4
    container_name: klass_postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_USER: "klass"
  klass-api:
    build:
      context: ../klass-api
      dockerfile: ../klass-api/Dockerfile
    container_name: klass-api
    ports:
      - "8080:8080"
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_USER: "klass"
      POSTGRES_INSTANCE: ${POSTGRES_INSTANCE}
  klass-forvaltning:
    build:
      context: ../klass-forvaltning
      dockerfile: ../klass-forvaltning/Dockerfile
    container_name: klass-forvaltning
    ports:
      - "8081:8081"
    environment:
      SPRING_PROFILES_ACTIVE: frontend, h2-inmemory, small-import, skip-indexing, embedded-solr